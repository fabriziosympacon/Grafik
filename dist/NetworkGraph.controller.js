sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/OverflowToolbarButton","sap/suite/ui/commons/sample/NetworkGraphBidirectionalCollapsing/utils/DataLoader","sap/suite/ui/commons/sample/NetworkGraphBidirectionalCollapsing/utils/datatable","sap/suite/ui/commons/sample/NetworkGraphBidirectionalCollapsing/utils/vorgaengerLoader","sap/suite/ui/commons/sample/NetworkGraphBidirectionalCollapsing/utils/VorgaengerTableUtils"],function(e,t,o,a,i,s,r){"use strict";return e.extend("sap.suite.ui.commons.sample.NetworkGraphBidirectionalCollapsing.NetworkGraph",{onInit:function(){var e=this.getView(),a=e.byId("graph"),s=new t({isLoading:true,data:{}});e.setModel(s);a.setBusy(true);var r=new t({isLoading:true,tableData:[],vorgaengerData:[]});e.setModel(r,"dataModel");this.baseUrl=window.location.hostname==="localhost"?"http://localhost:3000/api/":"https://ui5-mongodb-project.vercel.app/api/";i.loadData(r,null,false,this.baseUrl,function(e){r.setProperty("/tableData",e);r.setProperty("/isLoading",false);r.refresh(true)});a.getToolbar().addContent(new o({icon:"sap-icon://collapse-all",tooltip:"Collapse all nodes",type:"Transparent",press:this.hideAllNodes.bind(this)}));a.attachSelectionChange(this.selectionChange,this);var n=e.byId("dataTable");n.attachRowSelectionChange(this.onRowSelectionChange,this)},onRowSelectionChange:function(e){var t=e.getParameter("rowContext");if(t){var o=t.getObject();console.log("Selected row data:",o);var i=o.Archivierungsobjekt;var r=this.baseUrl+"vorgaenger?archivierungsobjekt="+i;console.log("Constructed URL:",r);s.loadVorgaengerData(r,this);a.loadGraphData(this.getView().getModel(),this.getView().byId("graph"),r,this.showAllNodes.bind(this))}},destroyGraph:function(){var e=this.getView().byId("graph");e.destroyNodes();e.destroyLines()},showAllNodes:function(){var e=this.getView().byId("graph");e.getNodes().forEach(function(e){e.setVisible(true)})},hideAllNodes:function(){var e=this.getView().byId("graph");e.getNodes().forEach(function(e){e.setVisible(false)})},selectionChange:function(e){console.log("Selection changed:",e.getParameter("items"))},replaceGraphData:function(e,t){var o=this.getView().byId("graph");this.destroyGraph();console.log("Aktuelle Nodes vor EinfÃ¼gen:",o.getNodes().map(e=>e.getKey()));if(Array.isArray(e)){e.forEach(function(e){var t=o.getNodes().find(t=>t.getKey()===e.key);if(!t){var a=new sap.suite.ui.commons.networkgraph.Node({key:e.key,title:e.title,shape:"Box",attributes:e.V_DE?[new sap.suite.ui.commons.networkgraph.ElementAttribute({label:e.V_DE})]:[]});o.addNode(a)}else{console.warn("Doppelter Node verhindert:",e.key)}})}else{console.error("nodesArray ist nicht korrekt")}if(Array.isArray(t)){t.forEach(function(e){o.addLine(new sap.suite.ui.commons.networkgraph.Line(e))})}else{console.error("linesArray ist nicht korrekt")}o.setBusy(false)},onVorgaengerTableSelectionChange:function(e){var t=r.onVorgaengerTableSelectionChange(e,this);if(t&&t.nodes&&t.lines){var o=t.nodes;var a=t.lines;console.log("Filtered Nodes:",o);console.log("Filtered Lines:",a);this.replaceGraphData(o,a)}}})});
//# sourceMappingURL=NetworkGraph.controller.js.map